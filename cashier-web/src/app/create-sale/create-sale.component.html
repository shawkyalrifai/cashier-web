<div class="container mt-5">
  <div class="card p-4 shadow">
    <h2 class="mb-4 text-center">Create Sale</h2>

    <div class="mb-3 row align-items-center">
      <label class="col-sm-2 col-form-label">Cashier ID:</label>
      <div class="col-sm-4">
        <input type="number" [(ngModel)]="cashierId" class="form-control" />
      </div>
    </div>

    <table class="table table-hover table-bordered">
      <thead class="table-light">
        <tr>
          <th>Image</th>
          <th>Product Name</th>
          <th>Stock</th>
          <th>Price</th>
          <th style="width: 120px;">Quantity</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of products">
          <th><img
      *ngIf="product.photoBase64"
      [src]="'data:image/jpeg;base64,' + product.photoBase64"
      alt="Photo"
      width="50"
      height="50"
      style="cursor: pointer; object-fit: cover; border-radius: 4px;"
      (click)="viewProductDetails(product.id)" /></th>
          <td>{{ product.name }}</td>
      
          <td>
            <ng-container *ngIf="product.stock > 0; else outOfStock">
              {{ product.stock }}
            </ng-container>
            <ng-template #outOfStock>
              <span class="text-danger">Product not found (Out of stock)</span>
            </ng-template>
          </td>
      
          <td>{{ product.price | currency }}</td>
      
          <td>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="product.quantity"
              [max]="product.stock"
              min="0"
              [disabled]="product.stock === 0"
              [ngClass]="{'bg-danger-subtle border-danger': product.stock === 0}"
            />
          </td>
        </tr>
      </tbody>
    </table>

    <div class="d-flex justify-content-end">
      <button class="btn btn-success" (click)="submitSale()">Submit Sale</button>
    </div>
  </div>
</div>



<div *ngIf="bill">
  <div id="bill-section" class="p-3 border rounded shadow bg-white">
    <h4 class="text-center">Sale Receipt</h4>
    <p><strong>Sale ID:</strong> {{ bill.id }}</p>
    <p><strong>Cashier Name:</strong> {{ username }}</p>
    <p><strong>Date:</strong> {{ bill.saleDate | date: 'short' }}</p>

    <table class="table table-bordered mt-3">
      <thead class="table-light">
        <tr>
          <th>Product</th>
          <th>Quantity</th>
          <th>Unit Price</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of bill.items">
          <td>{{ item.product.name }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ item.product.price | currency }}</td>
          <td>{{ item.subtotal | currency }}</td>
        </tr>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3" class="text-end"><strong>Total:</strong></td>
          <td>{{ bill.totalAmount | currency }}</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- Buttons -->
  <div class="mt-3 d-flex gap-3">
    <button class="btn btn-success" (click)="downloadPDF()">Download PDF</button>
    <button class="btn btn-primary" (click)="printPDF()">Print PDF</button>
  </div>
</div>

<div *ngIf="error" class="alert alert-danger mt-2">{{ error }}</div>
